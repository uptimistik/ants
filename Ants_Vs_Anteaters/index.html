<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Colony Clash $ANT</title>
    <link rel="stylesheet" type="text/css" href="css/gse-style.css" />
    <link rel="stylesheet" type="text/css" href="css/gse-style-loading.css" />
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: black;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #gse-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        /* ... (rest of your existing styles) ... */
    </style>
</head>
<body>
    <div id="gse-player" class="gse-frame">
        <!-- ... (rest of your existing HTML structure) ... -->
    </div>

    <script type="text/javascript">
    (function() {
        let gameEngine;
        let isTelegramWebapp = window.Telegram && window.Telegram.WebApp;

        function initApp() {
            if (isTelegramWebapp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
            }
            checkExistingAccount();
        }

        function checkExistingAccount() {
            if (localStorage.getItem('antUsername')) {
                loadGame();
            } else {
                showUsernameOverlay();
            }
        }

        function loadGame() {
            window.onEngineLoad = function() {
                gse.ready(function(engine) {
                    gameEngine = engine;
                    var loadingElement = document.getElementById('gse-loading');
                    var playerDelegate = {
                        onLoadingBegin: function() {
                            engine.showOverlay();
                            loadingElement.style.visibility = 'visible';
                        },
                        onLoadingEnd: function() {
                            loadingElement.style.visibility = 'hidden';
                            engine.hideOverlay();
                        },
                        onWindowResize: function() {
                            handleResize();
                        },
                        onGameCenterShowLeaderboard: function(identifier) {
                            displayLeaderboard(identifier);
                        },
                        onGameCenterPostScore: function(score, identifier) {
                            updateUserScore(score, identifier);
                        }
                    };

                    engine.appendDelegate(playerDelegate);
                    window.addEventListener('resize', handleResize, false);

                    engine.setRenderFrame('gse-player');
                    engine.setOptions({
                        'viewport-reference': 'window',
                        'viewport-fit': 'letterbox'
                    });
                    engine.loadOptionsFromURL();
                    engine.play();

                    handleResize();
                });
            };

            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = 'js/gse/gse-export.js';
            script.async = true;
            script.onload = window.onEngineLoad;
            document.body.appendChild(script);
        }

        function handleResize() {
            const gameContainer = document.getElementById('gse-player');
            if (gameContainer) {
                gameContainer.style.width = `${window.innerWidth}px`;
                gameContainer.style.height = `${window.innerHeight}px`;
            }
            
            if (gameEngine && gameEngine.relayout) {
                gameEngine.relayout();
            }
        }

        // ... (rest of your existing functions) ...

        // Start the process
        initApp();
    })();
    </script>
</body>
</html>