<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>GameSalad with Fractal Authentication</title>
<link rel="stylesheet" type="text/css" href="css/gse-style.css" />
<link rel="stylesheet" type="text/css" href="css/gse-style-loading.css" />
<style type="text/css">
body {
  background-color: black;
  margin: 0;
  padding: 0;
}
</style>
</head>
<body>
<div id="gse-player" class="gse-frame">
  <div class="gse-overlay">
    <div id="gse-text" class="gse-dialog">
      <div>
        <button id="gse-text-cancel">Cancel</button>
        <button id="gse-text-done">Done</button>
        <p id="gse-text-prompt"></p>
      </div>
      <div>
        <textarea id="gse-text-input"></textarea>
      </div>
    </div>
    <div id="gse-browser" class="gse-dialog">     
      <iframe id="gse-browser-frame"></iframe>
        <button id="gse-browser-close" href="#">&#10006;</button>
    </div>
    <div id="gse-loading" style="visibility: visible;">
      <img src="images/gse-loading.png" />
    </div>
  </div>
</div>

<script type="text/javascript" src="https://cdn.fractal.is/sdk/fractal-sdk.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
    if (typeof Fractal === 'undefined') {
        console.error('Fractal SDK is not loaded. Please check the SDK URL.');
        return;
    }

    Fractal.onLoad(() => {
        console.log('Fractal SDK loaded successfully.');

        function authenticateUser() {
            return new Promise((resolve, reject) => {
                Fractal.init({
                    clientId: 'AL1szGybA0YVtyC5Jk5w3z6hBPCPvy6P',
                    scopes: ['identify', 'coins:read', 'items:read'],
                    redirectUri: 'https://uptimistik.github.io/ants/Ants_Vs_Anteaters/',
                    onAuthSuccess: function(token) {
                        console.log('Authenticated successfully:', token);
                        resolve(token);
                    },
                    onAuthFailure: function(error) {
                        console.error('Authentication failed:', error);
                        reject(error);
                    }
                });
                Fractal.authenticate();
            });
        }

        function showLeaderboard() {
            Fractal.get('/leaderboard', function(response) {
                console.log('Leaderboard:', response);
                let leaderboardHtml = '<div class="leaderboard"><h2>Leaderboard</h2><ul>';
                response.data.forEach(item => {
                    leaderboardHtml += `<li>${item.username}: ${item.score}</li>`;
                });
                leaderboardHtml += '</ul></div>';
                document.body.innerHTML += leaderboardHtml;
            });
        }

        function postScore(score) {
            Fractal.post('/leaderboard/score', { score: score }, function(response) {
                console.log('Score posted:', response);
            });
        }

        // Event listeners for buttons or actions to authenticate, show leaderboard, and post score
        document.getElementById('loginButton').addEventListener('click', function() {
            authenticateUser().then(token => {
                console.log('User authenticated with token:', token);
            }).catch(error => {
                console.error('Error during authentication:', error);
            });
        });

        document.getElementById('showLeaderboardButton').addEventListener('click', function() {
            showLeaderboard();
        });

        document.getElementById('postScoreButton').addEventListener('click', function() {
            const score = parseInt(prompt('Enter your score:'));
            postScore(score);
        });
    });
});
</script>

<!-- Assuming you have buttons to trigger these actions -->
<button id="loginButton">Login with Fractal</button>
<button id="showLeaderboardButton">Show Leaderboard</button>
<button id="postScoreButton">Post Score</button>

<script type="text/javascript" src="js/gse/gse-export.js" async onload="onEngineLoad()"></script>
</body>
</html>
